FROM node:18-alpine
WORKDIR /app

# Only copy package manifests first for a reproducible layer
COPY package*.json ./
COPY package-lock*.json ./

# Install all dependencies including dev (needed for build)
RUN npm install

# Copy application sources and build config
COPY tsconfig*.json ./
COPY . .

# Build TypeScript (outputs alongside sources)
RUN npm run build

# Clean up dev dependencies
RUN npm install --omit=dev --no-audit --no-fund

EXPOSE 8081
CMD ["node", "dist/index.js"]